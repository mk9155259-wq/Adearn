<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AdEarn - বিজ্ঞাপন দেখে আয় করুন</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }

        :root {
            --primary-blue: #2d87f0;
            --secondary-blue: #e8f2ff;
            --accent-blue: #1a73e8;
            --dark-blue: #1a56db;
            --text-dark: #333333;
            --text-light: #666666;
            --white: #ffffff;
            --light-gray: #f5f5f5;
            --border-radius: 16px;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        body {
            background-color: var(--light-gray);
            color: var(--text-dark);
            max-width: 500px;
            margin: 0 auto;
            padding-bottom: 80px;
            min-height: 100vh;
            position: relative;
        }

        .container {
            padding: 16px;
        }

        /* Header Styles */
        .app-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            color: white;
            padding: 20px 16px;
            border-radius: 0 0 20px 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i {
            color: #ffd700;
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: var(--border-radius);
            padding: 18px;
            margin-top: 10px;
            box-shadow: var(--shadow-light);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .balance-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 6px;
        }

        .balance-amount {
            font-size: 32px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .currency {
            color: #ffd700;
            font-weight: 800;
        }

        /* Card Styles */
        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-light);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--primary-blue);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title i {
            color: var(--accent-blue);
        }

        /* Progress Bar */
        .progress-container {
            margin: 20px 0;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .progress-bar {
            height: 12px;
            background-color: var(--secondary-blue);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue));
            border-radius: 10px;
            width: 10%;
            transition: width 1s ease;
        }

        /* Button Styles */
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            margin-top: 16px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), var(--dark-blue));
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--dark-blue), var(--primary-blue));
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(42, 123, 242, 0.3);
        }

        .btn-secondary {
            background: var(--secondary-blue);
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
        }

        .btn-secondary:hover {
            background: var(--primary-blue);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #10b981);
            transform: translateY(-2px);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn-warning:hover {
            background: linear-gradient(135deg, #d97706, #f59e0b);
        }

        .btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* Stats Container */
        .stats-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 16px;
            text-align: center;
            box-shadow: var(--shadow-light);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-light);
        }

        /* Referral Section */
        .referral-link-container {
            display: flex;
            margin-bottom: 16px;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            overflow: hidden;
        }

        .referral-link {
            flex-grow: 1;
            padding: 14px;
            background: #f9f9f9;
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .copy-btn {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 0 18px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .copy-btn:hover {
            background: var(--dark-blue);
        }

        /* Withdraw Methods */
        .withdraw-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 16px;
        }

        .method-card {
            border: 2px solid var(--secondary-blue);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .method-card:hover {
            border-color: var(--primary-blue);
            background: var(--secondary-blue);
        }

        .method-card.selected {
            border-color: var(--primary-blue);
            background: var(--secondary-blue);
        }

        .method-icon {
            font-size: 24px;
            color: var(--primary-blue);
            margin-bottom: 8px;
        }

        .method-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .method-rate {
            font-size: 12px;
            color: var(--text-light);
        }

        /* History Items */
        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-type {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .history-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .history-icon.ad {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-blue));
        }

        .history-icon.referral {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .history-icon.withdraw {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .history-info h4 {
            font-size: 15px;
            margin-bottom: 4px;
        }

        .history-info p {
            font-size: 13px;
            color: var(--text-light);
        }

        .history-amount {
            font-weight: 700;
            font-size: 16px;
        }

        .positive {
            color: #10b981;
        }

        .negative {
            color: #ef4444;
        }

        /* Profile Section */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-blue);
        }

        .profile-info h2 {
            font-size: 20px;
            margin-bottom: 6px;
        }

        .profile-info p {
            color: var(--text-light);
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .verified-badge {
            background: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-blue);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-light);
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            background: #f5f5f5;
            color: var(--text-dark);
        }

        .modal-body {
            padding: 20px;
        }

        .notice-content {
            line-height: 1.6;
        }

        .notice-content h3 {
            margin: 16px 0 8px;
            color: var(--primary-blue);
        }

        .notice-content ul {
            padding-left: 20px;
            margin-bottom: 16px;
        }

        .notice-content li {
            margin-bottom: 6px;
        }

        /* Verification Task */
        .verification-task {
            text-align: center;
            padding: 20px 0;
        }

        .verification-icon {
            font-size: 60px;
            color: var(--primary-blue);
            margin-bottom: 16px;
        }

        .task-instruction {
            font-size: 16px;
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .verification-code {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: 10px;
            margin: 20px 0;
            padding: 10px;
            background: var(--secondary-blue);
            border-radius: 10px;
            color: var(--dark-blue);
        }

        /* Input Styles */
        .input-group {
            margin-bottom: 16px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
        }

        .input-field {
            width: 100%;
            padding: 14px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(45, 135, 240, 0.1);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            max-width: 500px;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            color: var(--text-light);
            padding: 8px 12px;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .nav-item.active {
            color: var(--primary-blue);
            background: var(--secondary-blue);
        }

        .nav-icon {
            font-size: 20px;
        }

        .nav-label {
            font-size: 12px;
            font-weight: 500;
        }

        /* Ad Timer */
        .ad-timer {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary-blue);
            text-align: center;
            margin: 30px 0;
        }

        .ad-instruction {
            text-align: center;
            margin-bottom: 20px;
            color: var(--text-light);
            line-height: 1.5;
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--secondary-blue);
            border-top: 4px solid var(--primary-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--white);
            color: var(--text-dark);
            padding: 16px 24px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: transform 0.5s ease;
            max-width: 90%;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            border-left: 4px solid #10b981;
        }

        .toast.error {
            border-left: 4px solid #ef4444;
        }

        .toast.info {
            border-left: 4px solid var(--primary-blue);
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .mb-1 {
            margin-bottom: 8px;
        }

        .mb-2 {
            margin-bottom: 16px;
        }

        .mb-3 {
            margin-bottom: 24px;
        }

        .mt-1 {
            margin-top: 8px;
        }

        .mt-2 {
            margin-top: 16px;
        }

        .mt-3 {
            margin-top: 24px;
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .container {
                padding: 12px;
            }
            
            .card {
                padding: 16px;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            .withdraw-methods {
                grid-template-columns: 1fr;
            }
            
            .balance-amount {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <!-- App Header -->
    <div class="app-header">
        <div class="header-top">
            <div class="logo">
                <i class="fas fa-ad"></i>
                AdEarn
            </div>
            <div id="userBalance" class="balance-amount">
                <span class="currency">HMSTR</span>
                <span id="balanceValue">0.00</span>
            </div>
        </div>
        <div class="balance-card">
            <div class="balance-label">আপনার ব্যালেন্স</div>
            <div class="balance-amount">
                <span class="currency">HMSTR</span>
                <span id="balanceValue2">0.00</span>
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div class="container">
        <!-- Home / Dashboard Section -->
        <section id="homeSection" class="content-section">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-chart-line"></i>
                    দৈনিক বিজ্ঞাপন প্রোগ্রেস
                </div>
                <div class="progress-container">
                    <div class="progress-info">
                        <span>আজ দেখা হয়েছে: <span id="adsWatched">0</span>/100</span>
                        <span id="adsProgressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div id="adsProgressFill" class="progress-fill"></div>
                    </div>
                </div>
                <button id="watchAdBtn" class="btn btn-primary">
                    <i class="fas fa-play-circle"></i> বিজ্ঞাপন দেখুন (0.50 HMSTR)
                </button>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-users"></i>
                    রেফারেল সিস্টেম
                </div>
                <div class="referral-link-container">
                    <div id="referralLink" class="referral-link">লোড হচ্ছে...</div>
                    <button id="copyLinkBtn" class="copy-btn">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                <div class="stats-container">
                    <div class="stat-card">
                        <div id="referralCount" class="stat-value">0</div>
                        <div class="stat-label">মোট রেফারেল</div>
                    </div>
                    <div class="stat-card">
                        <div id="referralEarnings" class="stat-value">0.00</div>
                        <div class="stat-label">রেফারেল আয়</div>
                    </div>
                </div>
                <button id="shareRefBtn" class="btn btn-secondary">
                    <i class="fas fa-share-alt"></i> শেয়ার করুন
                </button>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-user-check"></i>
                    হিউম্যান ভেরিফিকেশন
                </div>
                <div id="verificationStatus" class="text-center mb-2">
                    <p>আপনি এখনো ভেরিফাইড নন। ভেরিফিকেশন করুন এবং অতিরিক্ত সুবিধা পান।</p>
                </div>
                <button id="verifyBtn" class="btn btn-success">
                    <i class="fas fa-check-circle"></i> ভেরিফাই করুন
                </button>
            </div>
        </section>

        <!-- Earn Section -->
        <section id="earnSection" class="content-section hidden">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-ad"></i>
                    বিজ্ঞাপন দেখে আয় করুন
                </div>
                <p class="ad-instruction">
                    নিচের "বিজ্ঞাপন দেখুন" বাটনে ক্লিক করে বিজ্ঞাপন দেখুন এবং প্রতিটি বিজ্ঞাপনের জন্য 0.50 HMSTR পেয়ে যান। প্রতিদিন সর্বোচ্চ 100টি বিজ্ঞাপন দেখতে পারবেন।
                </p>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <div id="todayAds" class="stat-value">0</div>
                        <div class="stat-label">আজকের বিজ্ঞাপন</div>
                    </div>
                    <div class="stat-card">
                        <div id="totalAds" class="stat-value">0</div>
                        <div class="stat-label">মোট বিজ্ঞাপন</div>
                    </div>
                </div>
                
                <div id="adTimerContainer" class="hidden">
                    <div class="ad-timer" id="adTimer">30</div>
                    <p class="ad-instruction">
                        বিজ্ঞাপন দেখানো হচ্ছে... সময় শেষ হওয়া পর্যন্ত অপেক্ষা করুন
                    </p>
                </div>
                
                <button id="startAdBtn" class="btn btn-primary btn-large">
                    <i class="fas fa-play-circle"></i> বিজ্ঞাপন দেখুন (0.50 HMSTR)
                </button>
                
                <p class="text-center mt-2" style="color: var(--text-light); font-size: 14px;">
                    প্রতিটি বিজ্ঞাপন দেখার জন্য 30 সেকেন্ড সময় প্রয়োজন
                </p>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-handshake"></i>
                    রেফারেল দিয়ে আয় করুন
                </div>
                <p class="mb-2">
                    আপনার রেফারেল লিংক শেয়ার করুন এবং প্রতিটি রেফারেলের জন্য 1.00 HMSTR পান। রেফারেলকে কমপক্ষে 10টি বিজ্ঞাপন দেখতে হবে।
                </p>
                
                <div class="referral-link-container">
                    <div id="earnReferralLink" class="referral-link">লোড হচ্ছে...</div>
                    <button id="copyEarnLinkBtn" class="copy-btn">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card">
                        <div id="activeReferrals" class="stat-value">0</div>
                        <div class="stat-label">এক্টিভ রেফারেল</div>
                    </div>
                    <div class="stat-card">
                        <div id="totalRefEarnings" class="stat-value">0.00</div>
                        <div class="stat-label">মোট রেফারেল আয়</div>
                    </div>
                </div>
                
                <button id="shareEarnRefBtn" class="btn btn-secondary">
                    <i class="fas fa-share-alt"></i> রেফারেল লিংক শেয়ার করুন
                </button>
            </div>
        </section>

        <!-- Withdraw Section -->
        <section id="withdrawSection" class="content-section hidden">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-wallet"></i>
                    উত্তোলন করুন
                </div>
                <p class="mb-2">
                    সর্বনিম্ন উত্তোলনযোগ্য পরিমাণ: <strong>10,000 HMSTR</strong>
                </p>
                <p class="mb-3" style="color: var(--text-light); font-size: 14px;">
                    আপনার ব্যালেন্স: <span id="withdrawBalance" class="currency">HMSTR</span> <span id="withdrawBalanceValue">0.00</span>
                </p>
                
                <div class="input-group">
                    <label class="input-label" for="withdrawAmount">উত্তোলনের পরিমাণ (HMSTR)</label>
                    <input type="number" id="withdrawAmount" class="input-field" placeholder="10000" min="10000" step="1">
                </div>
                
                <div class="input-group">
                    <label class="input-label">উত্তোলন পদ্ধতি নির্বাচন করুন</label>
                    <div class="withdraw-methods">
                        <div class="method-card" data-method="bkash" data-rate="530">
                            <div class="method-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div class="method-name">বিকাশ</div>
                            <div class="method-rate">530 HMSTR = 1 BDT</div>
                        </div>
                        <div class="method-card" data-method="nagad" data-rate="530">
                            <div class="method-icon">
                                <i class="fas fa-wallet"></i>
                            </div>
                            <div class="method-name">নগদ</div>
                            <div class="method-rate">530 HMSTR = 1 BDT</div>
                        </div>
                        <div class="method-card" data-method="mobile" data-rate="10000">
                            <div class="method-icon">
                                <i class="fas fa-sim-card"></i>
                            </div>
                            <div class="method-name">মোবাইল রিচার্জ</div>
                            <div class="method-rate">10,000 HMSTR = 80 BDT</div>
                        </div>
                        <div class="method-card" data-method="usdt" data-rate="1000">
                            <div class="method-icon">
                                <i class="fab fa-usd"></i>
                            </div>
                            <div class="method-name">USDT (BEP20)</div>
                            <div class="method-rate">1000 HMSTR = 1 USDT</div>
                        </div>
                    </div>
                </div>
                
                <div class="input-group" id="methodDetailsContainer" style="display: none;">
                    <label class="input-label" id="methodDetailsLabel">বিকাশ নম্বর</label>
                    <input type="text" id="methodDetails" class="input-field" placeholder="01XXXXXXXXX">
                </div>
                
                <button id="submitWithdrawBtn" class="btn btn-primary" disabled>
                    উত্তোলন রিকুয়েস্ট সাবমিট করুন
                </button>
                
                <p class="text-center mt-2" style="color: var(--text-light); font-size: 14px;">
                    উত্তোলন রিকুয়েস্ট 24-48 ঘন্টার মধ্যে প্রসেস করা হবে
                </p>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-history"></i>
                    উত্তোলন ইতিহাস
                </div>
                <div class="history-list" id="withdrawHistory">
                    <div class="text-center" style="padding: 30px; color: var(--text-light);">
                        <i class="fas fa-history" style="font-size: 40px; margin-bottom: 16px;"></i>
                        <p>কোন উত্তোলন ইতিহাস পাওয়া যায়নি</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- History Section -->
        <section id="historySection" class="content-section hidden">
            <div class="card">
                <div class="card-title">
                    <i class="fas fa-history"></i>
                    আয়ের ইতিহাস
                </div>
                <div class="history-list" id="earningsHistory">
                    <div class="text-center" style="padding: 30px; color: var(--text-light);">
                        <i class="fas fa-history" style="font-size: 40px; margin-bottom: 16px;"></i>
                        <p>কোন আয়ের ইতিহাস পাওয়া যায়নি</p>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-users"></i>
                    রেফারেল ইতিহাস
                </div>
                <div class="history-list" id="referralHistory">
                    <div class="text-center" style="padding: 30px; color: var(--text-light);">
                        <i class="fas fa-users" style="font-size: 40px; margin-bottom: 16px;"></i>
                        <p>কোন রেফারেল ইতিহাস পাওয়া যায়নি</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Section -->
        <section id="profileSection" class="content-section hidden">
            <div class="card">
                <div class="profile-header">
                    <img id="profilePhoto" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" alt="Profile" class="profile-avatar">
                    <div class="profile-info">
                        <h2 id="profileName">লোড হচ্ছে...</h2>
                        <p>
                            <span id="profileUsername">@username</span>
                            <span id="verifiedBadge" class="verified-badge hidden">
                                <i class="fas fa-check"></i> ভেরিফাইড
                            </span>
                        </p>
                        <p id="memberSince">সদস্য: লোড হচ্ছে...</p>
                    </div>
                </div>

                <div class="stats-container">
                    <div class="stat-card">
                        <div id="profileBalance" class="stat-value">0.00</div>
                        <div class="stat-label">ব্যালেন্স</div>
                    </div>
                    <div class="stat-card">
                        <div id="profileReferrals" class="stat-value">0</div>
                        <div class="stat-label">রেফারেল</div>
                    </div>
                    <div class="stat-card">
                        <div id="profileAds" class="stat-value">0</div>
                        <div class="stat-label">বিজ্ঞাপন</div>
                    </div>
                    <div class="stat-card">
                        <div id="profileEarnings" class="stat-value">0.00</div>
                        <div class="stat-label">মোট আয়</div>
                    </div>
                </div>

                <button id="contactDeveloperBtn" class="btn btn-secondary mt-2">
                    <i class="fas fa-headset"></i> ডেভেলপার এর সাথে যোগাযোগ
                </button>
                
                <button id="logoutBtn" class="btn btn-warning mt-1">
                    <i class="fas fa-sign-out-alt"></i> লগআউট
                </button>
            </div>

            <div class="card">
                <div class="card-title">
                    <i class="fas fa-info-circle"></i>
                    অ্যাপ সম্পর্কে
                </div>
                <p class="mb-2">
                    <strong>AdEarn</strong> হলো একটি টেলিগ্রাম মিনি অ্যাপ যেখানে আপনি সহজেই বিজ্ঞাপন দেখে আয় করতে পারবেন।
                </p>
                <p class="mb-2">
                    <strong>ভার্সন:</strong> 1.0.0
                </p>
                <p>
                    <strong>ডেভেলপার:</strong> AdEarn Team
                </p>
            </div>
        </section>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" class="nav-item active" data-section="home">
            <i class="fas fa-home nav-icon"></i>
            <span class="nav-label">হোম</span>
        </a>
        <a href="#" class="nav-item" data-section="earn">
            <i class="fas fa-ad nav-icon"></i>
            <span class="nav-label">আয়</span>
        </a>
        <a href="#" class="nav-item" data-section="withdraw">
            <i class="fas fa-wallet nav-icon"></i>
            <span class="nav-label">উত্তোলন</span>
        </a>
        <a href="#" class="nav-item" data-section="history">
            <i class="fas fa-history nav-icon"></i>
            <span class="nav-label">ইতিহাস</span>
        </a>
        <a href="#" class="nav-item" data-section="profile">
            <i class="fas fa-user nav-icon"></i>
            <span class="nav-label">প্রোফাইল</span>
        </a>
    </nav>

    <!-- Notice Modal -->
    <div id="noticeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-bullhorn"></i> নোটিশ ও নিয়মাবলী
                </h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="notice-content">
                    <h3>সর্বশেষ আপডেট:</h3>
                    <p>আমরা নতুন বিজ্ঞাপন প্রোভাইডার GigaPub যোগ করেছি! এখন থেকে আরও বেশি আয় করার সুযোগ পাবেন।</p>
                    
                    <h3>নিয়মাবলী:</h3>
                    <ul>
                        <li>প্রতিদিন সর্বোচ্চ 100টি বিজ্ঞাপন দেখতে পারবেন</li>
                        <li>প্রতিটি বিজ্ঞাপনের জন্য 0.50 HMSTR পাবেন</li>
                        <li>প্রতিটি রেফারেলের জন্য 1.00 HMSTR পাবেন</li>
                        <li>রেফারেলকে কমপক্ষে 10টি বিজ্ঞাপন দেখতে হবে</li>
                        <li>সর্বনিম্ন উত্তোলন 10,000 HMSTR</li>
                        <li>কোন ফ্রড বা গেম নিয়ম ভঙ্গ করলে অ্যাকাউন্ট বাতিল করা হবে</li>
                    </ul>
                    
                    <h3>গুরুত্বপূর্ণ তথ্য:</h3>
                    <p>বিজ্ঞাপন দেখার সময় পেজ রিফ্রেশ করবেন না, অন্যথায় আয় যোগ হবে না। প্রতিটি বিজ্ঞাপনের জন্য কমপক্ষে 30 সেকেন্ড অপেক্ষা করুন।</p>
                </div>
                <button id="closeNoticeBtn" class="btn btn-primary mt-3">বুঝেছি</button>
            </div>
        </div>
    </div>

    <!-- Verification Modal -->
    <div id="verificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-user-check"></i> হিউম্যান ভেরিফিকেশন
                </h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="verification-task">
                    <div class="verification-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <p class="task-instruction">
                        নিচের কোডটি মনে রাখুন এবং পরবর্তী পেজে এটি লিখুন। এটি প্রমাণ করবে যে আপনি রোবট নন।
                    </p>
                    <div id="verificationCode" class="verification-code">A3B8</div>
                    <p class="task-instruction">
                        "ভেরিফিকেশন সম্পন্ন করুন" বাটনে ক্লিক করে ভেরিফিকেশন প্রক্রিয়া শুরু করুন।
                    </p>
                    <a id="verificationLink" href="https://link.gigapub.tech/l/9pp3y1rr" target="_blank" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> ভেরিফিকেশন সম্পন্ন করুন
                    </a>
                    <button id="completeVerificationBtn" class="btn btn-success mt-2">
                        <i class="fas fa-check-circle"></i> আমি ভেরিফিকেশন সম্পন্ন করেছি
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ad Watch Modal -->
    <div id="adWatchModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-ad"></i> বিজ্ঞাপন দেখুন
                </h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="verification-task">
                    <div class="verification-icon">
                        <i class="fas fa-play-circle"></i>
                    </div>
                    <p class="task-instruction">
                        নিচের লিংকে ক্লিক করে বিজ্ঞাপন দেখুন এবং 30 সেকেন্ড অপেক্ষা করুন। সময় শেষ হলে "আয় ক্লেইম করুন" বাটনে ক্লিক করুন।
                    </p>
                    <a id="adProviderLink" href="https://link.gigapub.tech/l/9pp3y1rr" target="_blank" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> বিজ্ঞাপন দেখুন
                    </a>
                    <div id="adModalTimer" class="ad-timer">30</div>
                    <button id="claimAdRewardBtn" class="btn btn-success" disabled>
                        <i class="fas fa-coins"></i> আয় ক্লেইম করুন (0.50 HMSTR)
                    </button>
                    <p class="text-center mt-2" style="color: var(--text-light); font-size: 14px;">
                        বিজ্ঞাপন দেখার সময় পেজ রিফ্রেশ করবেন না
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i id="toastIcon" class="fas fa-info-circle"></i>
        <span id="toastMessage">This is a toast message</span>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script>
        // ========================
        // Firebase Configuration
        // ========================
        const firebaseConfig = {
            apiKey: "AIzaSyCppnCPW_npU7QS8tmkX4MGzBtYx35I6G4",
            authDomain: "adearn-79f8b.firebaseapp.com",
            databaseURL: "https://adearn-79f8b-default-rtdb.firebaseio.com",
            projectId: "adearn-79f8b",
            storageBucket: "adearn-79f8b.firebasestorage.app",
            messagingSenderId: "136478270159",
            appId: "1:136478270159:web:24484fc7b56f81ad2f0dba",
            measurementId: "G-JJJ3TN25F4"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // ========================
        // Telegram WebApp Initialization
        // ========================
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        // ========================
        // Global Variables
        // ========================
        let currentUser = null;
        let userData = null;
        let adTimer = null;
        let adTimeLeft = 30;
        let isAdRunning = false;
        let selectedWithdrawMethod = null;
        let verificationCode = generateVerificationCode();

        // ========================
        // DOM Elements
        // ========================
        const sections = {
            home: document.getElementById('homeSection'),
            earn: document.getElementById('earnSection'),
            withdraw: document.getElementById('withdrawSection'),
            history: document.getElementById('historySection'),
            profile: document.getElementById('profileSection')
        };

        const navItems = document.querySelectorAll('.nav-item');
        const modals = {
            notice: document.getElementById('noticeModal'),
            verification: document.getElementById('verificationModal'),
            adWatch: document.getElementById('adWatchModal')
        };

        const closeModalButtons = document.querySelectorAll('.close-modal');
        const toast = document.getElementById('toast');

        // ========================
        // Utility Functions
        // ========================
        function showToast(message, type = 'info') {
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');
            
            // Set icon based on type
            switch(type) {
                case 'success':
                    toastIcon.className = 'fas fa-check-circle';
                    toast.className = 'toast success';
                    break;
                case 'error':
                    toastIcon.className = 'fas fa-exclamation-circle';
                    toast.className = 'toast error';
                    break;
                default:
                    toastIcon.className = 'fas fa-info-circle';
                    toast.className = 'toast info';
            }
            
            toastMessage.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function generateVerificationCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 4; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function formatDate(timestamp) {
            if (!timestamp) return 'N/A';
            const date = new Date(timestamp);
            return date.toLocaleDateString('bn-BD') + ' ' + date.toLocaleTimeString('bn-BD');
        }

        function formatNumber(num) {
            return parseFloat(num).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // ========================
        // Authentication & User Management
        // ========================
        async function initializeUser() {
            try {
                // Get Telegram user data
                const tgUser = tg.initDataUnsafe.user;
                
                if (!tgUser || !tgUser.id) {
                    showToast('টেলিগ্রাম ব্যবহারকারী ডাটা পাওয়া যায়নি', 'error');
                    return;
                }

                // Create custom token using Telegram user ID
                const userId = tgUser.id.toString();
                const username = tgUser.username || `user_${userId.substring(0, 6)}`;
                const firstName = tgUser.first_name || 'User';
                const lastName = tgUser.last_name || '';
                const fullName = `${firstName} ${lastName}`.trim();
                const photoUrl = tgUser.photo_url || 'https://cdn-icons-png.flaticon.com/512/149/149071.png';

                // Sign in with custom token (Telegram ID)
                await auth.signInWithCustomToken(userId);
                currentUser = auth.currentUser;

                // Check if user exists in database
                const userRef = database.ref('users/' + userId);
                const snapshot = await userRef.once('value');
                
                if (!snapshot.exists()) {
                    // Create new user
                    const newUser = {
                        username: username,
                        fullName: fullName,
                        photoUrl: photoUrl,
                        balance: 0,
                        referralCount: 0,
                        referredBy: getReferredByFromStartParam(),
                        verified: false,
                        joinedAt: Date.now(),
                        totalAds: 0,
                        totalEarnings: 0,
                        todayAds: 0,
                        lastAdDate: null
                    };
                    
                    await userRef.set(newUser);
                    
                    // If referred by someone, update referrer's data
                    const referredBy = getReferredByFromStartParam();
                    if (referredBy) {
                        await updateReferralData(referredBy, userId);
                    }
                    
                    showToast('নতুন অ্যাকাউন্ট তৈরি হয়েছে! স্বাগতম!', 'success');
                }
                
                // Load user data
                await loadUserData(userId);
                
                // Show notice modal for new users
                setTimeout(() => {
                    modals.notice.classList.add('active');
                }, 1000);
                
            } catch (error) {
                console.error('Error initializing user:', error);
                showToast('ব্যবহারকারী লোড করতে সমস্যা হয়েছে', 'error');
            }
        }

        function getReferredByFromStartParam() {
            // Extract referral ID from Telegram start parameter
            const startParam = tg.initDataUnsafe.start_param;
            if (startParam && startParam.startsWith('ref_')) {
                return startParam.replace('ref_', '');
            }
            return null;
        }

        async function updateReferralData(referrerId, referredUserId) {
            try {
                const referrerRef = database.ref('users/' + referrerId);
                const referralRef = database.ref('referrals/' + referrerId + '/' + referredUserId);
                
                // Update referrer's referral count
                await referrerRef.transaction((user) => {
                    if (user) {
                        user.referralCount = (user.referralCount || 0) + 1;
                        user.balance = (user.balance || 0) + 1.00; // Add referral bonus
                    }
                    return user;
                });
                
                // Create referral record
                await referralRef.set({
                    userId: referredUserId,
                    referredAt: Date.now(),
                    earnings: 1.00,
                    status: 'active'
                });
                
                // Add to referral earnings history
                const historyRef = database.ref('earningsHistory/' + referrerId).push();
                await historyRef.set({
                    type: 'referral',
                    amount: 1.00,
                    description: `রেফারেল: ${referredUserId}`,
                    timestamp: Date.now()
                });
                
            } catch (error) {
                console.error('Error updating referral data:', error);
            }
        }

        async function loadUserData(userId) {
            try {
                const userRef = database.ref('users/' + userId);
                
                userRef.on('value', (snapshot) => {
                    userData = snapshot.val();
                    if (userData) {
                        updateUIWithUserData();
                    }
                });
                
            } catch (error) {
                console.error('Error loading user data:', error);
                showToast('ব্যবহারকারী ডাটা লোড করতে সমস্যা হয়েছে', 'error');
            }
        }

        function updateUIWithUserData() {
            if (!userData) return;
            
            // Update balance
            document.getElementById('balanceValue').textContent = formatNumber(userData.balance || 0);
            document.getElementById('balanceValue2').textContent = formatNumber(userData.balance || 0);
            document.getElementById('withdrawBalanceValue').textContent = formatNumber(userData.balance || 0);
            document.getElementById('profileBalance').textContent = formatNumber(userData.balance || 0);
            
            // Update ads progress
            const todayAds = userData.todayAds || 0;
            const adsProgress = (todayAds / 100) * 100;
            document.getElementById('adsWatched').textContent = todayAds;
            document.getElementById('adsProgressPercent').textContent = `${adsProgress}%`;
            document.getElementById('adsProgressFill').style.width = `${adsProgress}%`;
            document.getElementById('todayAds').textContent = todayAds;
            document.getElementById('totalAds').textContent = userData.totalAds || 0;
            document.getElementById('profileAds').textContent = userData.totalAds || 0;
            
            // Update referral data
            document.getElementById('referralCount').textContent = userData.referralCount || 0;
            document.getElementById('profileReferrals').textContent = userData.referralCount || 0;
            document.getElementById('activeReferrals').textContent = userData.referralCount || 0;
            
            // Update profile info
            document.getElementById('profileName').textContent = userData.fullName || userData.username;
            document.getElementById('profileUsername').textContent = '@' + userData.username;
            document.getElementById('profilePhoto').src = userData.photoUrl || 'https://cdn-icons-png.flaticon.com/512/149/149071.png';
            
            // Update member since
            if (userData.joinedAt) {
                const joinDate = new Date(userData.joinedAt);
                document.getElementById('memberSince').textContent = `সদস্য: ${joinDate.toLocaleDateString('bn-BD')}`;
            }
            
            // Update verification status
            if (userData.verified) {
                document.getElementById('verifiedBadge').classList.remove('hidden');
                document.getElementById('verificationStatus').innerHTML = `
                    <p style="color: #10b981;"><i class="fas fa-check-circle"></i> আপনি ভেরিফাইড ব্যবহারকারী!</p>
                `;
                document.getElementById('verifyBtn').innerHTML = '<i class="fas fa-check-circle"></i> ভেরিফাইড';
                document.getElementById('verifyBtn').disabled = true;
                document.getElementById('verifyBtn').classList.remove('btn-success');
                document.getElementById('verifyBtn').classList.add('btn-secondary');
            }
            
            // Update referral links
            const referralLink = `https://t.me/AdEarnBot?start=ref_${tg.initDataUnsafe.user.id}`;
            document.getElementById('referralLink').textContent = referralLink;
            document.getElementById('earnReferralLink').textContent = referralLink;
            
            // Update total earnings
            document.getElementById('profileEarnings').textContent = formatNumber(userData.totalEarnings || 0);
            
            // Load history data
            loadEarningsHistory();
            loadWithdrawHistory();
            loadReferralHistory();
        }

        // ========================
        // Ad System
        // ========================
        async function startAdWatch() {
            if (isAdRunning) {
                showToast('ইতিমধ্যে একটি বিজ্ঞাপন চলছে', 'error');
                return;
            }
            
            const userId = tg.initDataUnsafe.user.id.toString();
            const today = new Date().toDateString();
            const lastAdDate = userData.lastAdDate ? new Date(userData.lastAdDate).toDateString() : null;
            
            // Check daily limit
            if (lastAdDate === today && userData.todayAds >= 100) {
                showToast('আজকের জন্য আপনার বিজ্ঞাপন লিমিট শেষ হয়েছে', 'error');
                return;
            }
            
            // Reset today's count if it's a new day
            let todayAds = userData.todayAds || 0;
            if (lastAdDate !== today) {
                todayAds = 0;
            }
            
            // Open ad watch modal
            modals.adWatch.classList.add('active');
            adTimeLeft = 30;
            document.getElementById('adModalTimer').textContent = adTimeLeft;
            document.getElementById('claimAdRewardBtn').disabled = true;
            isAdRunning = true;
            
            // Start timer
            adTimer = setInterval(() => {
                adTimeLeft--;
                document.getElementById('adModalTimer').textContent = adTimeLeft;
                
                if (adTimeLeft <= 0) {
                    clearInterval(adTimer);
                    document.getElementById('claimAdRewardBtn').disabled = false;
                    showToast('বিজ্ঞাপন সম্পন্ন হয়েছে! এখন আয় ক্লেইম করুন', 'success');
                }
            }, 1000);
        }

        async function claimAdReward() {
            if (adTimeLeft > 0) {
                showToast('দয়া করে বিজ্ঞাপনের সময় শেষ হওয়া পর্যন্ত অপেক্ষা করুন', 'error');
                return;
            }
            
            const userId = tg.initDataUnsafe.user.id.toString();
            const today = new Date().toDateString();
            const lastAdDate = userData.lastAdDate ? new Date(userData.lastAdDate).toDateString() : null;
            
            // Check if already claimed today's limit
            if (lastAdDate === today && userData.todayAds >= 100) {
                showToast('আজকের জন্য আপনার বিজ্ঞাপন লিমিট শেষ হয়েছে', 'error');
                return;
            }
            
            try {
                const userRef = database.ref('users/' + userId);
                
                // Update user data
                await userRef.transaction((user) => {
                    if (user) {
                        const isNewDay = lastAdDate !== today;
                        
                        user.balance = (user.balance || 0) + 0.50;
                        user.totalEarnings = (user.totalEarnings || 0) + 0.50;
                        user.totalAds = (user.totalAds || 0) + 1;
                        user.todayAds = isNewDay ? 1 : (user.todayAds || 0) + 1;
                        user.lastAdDate = Date.now();
                    }
                    return user;
                });
                
                // Add to earnings history
                const historyRef = database.ref('earningsHistory/' + userId).push();
                await historyRef.set({
                    type: 'ad',
                    amount: 0.50,
                    description: 'বিজ্ঞাপন দেখেছেন',
                    timestamp: Date.now()
                });
                
                // Close modal and reset state
                modals.adWatch.classList.remove('active');
                clearInterval(adTimer);
                isAdRunning = false;
                
                showToast('0.50 HMSTR আয় যোগ হয়েছে!', 'success');
                
            } catch (error) {
                console.error('Error claiming ad reward:', error);
                showToast('আয় যোগ করতে সমস্যা হয়েছে', 'error');
            }
        }

        // ========================
        // Verification System
        // ========================
        async function completeVerification() {
            const userId = tg.initDataUnsafe.user.id.toString();
            
            try {
                const userRef = database.ref('users/' + userId);
                
                // Update verification status
                await userRef.update({
                    verified: true
                });
                
                // Add verification reward
                await userRef.transaction((user) => {
                    if (user) {
                        user.balance = (user.balance || 0) + 5.00;
                        user.totalEarnings = (user.totalEarnings || 0) + 5.00;
                    }
                    return user;
                });
                
                // Add to earnings history
                const historyRef = database.ref('earningsHistory/' + userId).push();
                await historyRef.set({
                    type: 'verification',
                    amount: 5.00,
                    description: 'হিউম্যান ভেরিফিকেশন বোনাস',
                    timestamp: Date.now()
                });
                
                // Close modal
                modals.verification.classList.remove('active');
                
                showToast('ভেরিফিকেশন সম্পন্ন হয়েছে! 5.00 HMSTR বোনাস পেয়েছেন!', 'success');
                
            } catch (error) {
                console.error('Error completing verification:', error);
                showToast('ভেরিফিকেশন সম্পন্ন করতে সমস্যা হয়েছে', 'error');
            }
        }

        // ========================
        // Withdraw System
        // ========================
        function setupWithdrawMethods() {
            const methodCards = document.querySelectorAll('.method-card');
            
            methodCards.forEach(card => {
                card.addEventListener('click', () => {
                    // Remove selected class from all cards
                    methodCards.forEach(c => c.classList.remove('selected'));
                    
                    // Add selected class to clicked card
                    card.classList.add('selected');
                    
                    // Set selected method
                    selectedWithdrawMethod = card.dataset.method;
                    const rate = card.dataset.rate;
                    
                    // Show method details input
                    const container = document.getElementById('methodDetailsContainer');
                    const label = document.getElementById('methodDetailsLabel');
                    const input = document.getElementById('methodDetails');
                    
                    container.style.display = 'block';
                    
                    // Set label and placeholder based on method
                    switch(selectedWithdrawMethod) {
                        case 'bkash':
                            label.textContent = 'বিকাশ নম্বর';
                            input.placeholder = '01XXXXXXXXX';
                            break;
                        case 'nagad':
                            label.textContent = 'নগদ নম্বর';
                            input.placeholder = '01XXXXXXXXX';
                            break;
                        case 'mobile':
                            label.textContent = 'মোবাইল নম্বর';
                            input.placeholder = '01XXXXXXXXX';
                            break;
                        case 'usdt':
                            label.textContent = 'USDT BEP20 ওয়ালেট এড্রেস';
                            input.placeholder = '0x...';
                            break;
                    }
                    
                    // Enable submit button if amount is valid
                    checkWithdrawSubmit();
                });
            });
            
            // Handle withdraw amount input
            const amountInput = document.getElementById('withdrawAmount');
            amountInput.addEventListener('input', checkWithdrawSubmit);
            
            // Handle method details input
            const detailsInput = document.getElementById('methodDetails');
            detailsInput.addEventListener('input', checkWithdrawSubmit);
        }

        function checkWithdrawSubmit() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value) || 0;
            const details = document.getElementById('methodDetails').value.trim();
            const balance = userData?.balance || 0;
            const button = document.getElementById('submitWithdrawBtn');
            
            if (amount >= 10000 && amount <= balance && selectedWithdrawMethod && details.length > 5) {
                button.disabled = false;
            } else {
                button.disabled = true;
            }
        }

        async function submitWithdrawRequest() {
            const userId = tg.initDataUnsafe.user.id.toString();
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const details = document.getElementById('methodDetails').value.trim();
            const balance = userData?.balance || 0;
            
            if (amount < 10000) {
                showToast('সর্বনিম্ন উত্তোলন 10,000 HMSTR', 'error');
                return;
            }
            
            if (amount > balance) {
                showToast('পর্যাপ্ত ব্যালেন্স নেই', 'error');
                return;
            }
            
            if (!selectedWithdrawMethod) {
                showToast('উত্তোলন পদ্ধতি নির্বাচন করুন', 'error');
                return;
            }
            
            if (details.length < 5) {
                showToast('বিবরণ সঠিকভাবে দিন', 'error');
                return;
            }
            
            try {
                // Calculate equivalent amount
                let equivalent = 0;
                switch(selectedWithdrawMethod) {
                    case 'bkash':
                    case 'nagad':
                        equivalent = amount / 530;
                        break;
                    case 'mobile':
                        equivalent = 80; // Fixed 80 BDT for mobile recharge
                        break;
                    case 'usdt':
                        equivalent = amount / 1000;
                        break;
                }
                
                // Create withdraw request
                const withdrawRef = database.ref('withdrawRequests').push();
                await withdrawRef.set({
                    userId: userId,
                    amount: amount,
                    method: selectedWithdrawMethod,
                    details: details,
                    equivalent: equivalent.toFixed(2),
                    status: 'pending',
                    requestedAt: Date.now()
                });
                
                // Deduct from user balance
                const userRef = database.ref('users/' + userId);
                await userRef.update({
                    balance: balance - amount
                });
                
                // Add to earnings history
                const historyRef = database.ref('earningsHistory/' + userId).push();
                await historyRef.set({
                    type: 'withdraw',
                    amount: -amount,
                    description: `উত্তোলন রিকুয়েস্ট: ${selectedWithdrawMethod}`,
                    timestamp: Date.now()
                });
                
                // Reset form
                document.getElementById('withdrawAmount').value = '';
                document.getElementById('methodDetails').value = '';
                document.querySelectorAll('.method-card').forEach(c => c.classList.remove('selected'));
                document.getElementById('methodDetailsContainer').style.display = 'none';
                selectedWithdrawMethod = null;
                document.getElementById('submitWithdrawBtn').disabled = true;
                
                showToast('উত্তোলন রিকুয়েস্ট সাবমিট হয়েছে! 24-48 ঘন্টার মধ্যে প্রসেস করা হবে।', 'success');
                
                // Reload withdraw history
                loadWithdrawHistory();
                
            } catch (error) {
                console.error('Error submitting withdraw request:', error);
                showToast('উত্তোলন রিকুয়েস্ট সাবমিট করতে সমস্যা হয়েছে', 'error');
            }
        }

        // ========================
        // History Loading
        // ========================
        async function loadEarningsHistory() {
            const userId = tg.initDataUnsafe.user.id.toString();
            const historyContainer = document.getElementById('earningsHistory');
            
            try {
                const snapshot = await database.ref('earningsHistory/' + userId).orderByChild('timestamp').limitToLast(10).once('value');
                
                if (!snapshot.exists()) {
                    return;
                }
                
                const historyItems = [];
                snapshot.forEach((childSnapshot) => {
                    const item = childSnapshot.val();
                    item.id = childSnapshot.key;
                    historyItems.unshift(item); // Reverse order (newest first)
                });
                
                // Update UI
                if (historyItems.length > 0) {
                    let html = '';
                    historyItems.forEach(item => {
                        const isNegative = item.amount < 0;
                        const iconClass = item.type === 'ad' ? 'ad' : item.type === 'referral' ? 'referral' : 'withdraw';
                        const icon = item.type === 'ad' ? 'fas fa-ad' : item.type === 'referral' ? 'fas fa-users' : 'fas fa-wallet';
                        const typeText = item.type === 'ad' ? 'বিজ্ঞাপন' : item.type === 'referral' ? 'রেফারেল' : 'উত্তোলন';
                        
                        html += `
                            <div class="history-item">
                                <div class="history-type">
                                    <div class="history-icon ${iconClass}">
                                        <i class="${icon}"></i>
                                    </div>
                                    <div class="history-info">
                                        <h4>${typeText}</h4>
                                        <p>${item.description || ''}</p>
                                        <p>${formatDate(item.timestamp)}</p>
                                    </div>
                                </div>
                                <div class="history-amount ${isNegative ? 'negative' : 'positive'}">
                                    ${isNegative ? '' : '+'}${formatNumber(item.amount)} HMSTR
                                </div>
                            </div>
                        `;
                    });
                    
                    historyContainer.innerHTML = html;
                }
                
            } catch (error) {
                console.error('Error loading earnings history:', error);
            }
        }

        async function loadWithdrawHistory() {
            const userId = tg.initDataUnsafe.user.id.toString();
            const historyContainer = document.getElementById('withdrawHistory');
            
            try {
                const snapshot = await database.ref('withdrawRequests').orderByChild('userId').equalTo(userId).limitToLast(5).once('value');
                
                if (!snapshot.exists()) {
                    return;
                }
                
                const historyItems = [];
                snapshot.forEach((childSnapshot) => {
                    const item = childSnapshot.val();
                    item.id = childSnapshot.key;
                    historyItems.unshift(item); // Reverse order (newest first)
                });
                
                // Update UI
                if (historyItems.length > 0) {
                    let html = '';
                    historyItems.forEach(item => {
                        const statusClass = item.status === 'approved' ? 'positive' : item.status === 'rejected' ? 'negative' : '';
                        const statusText = item.status === 'pending' ? 'মুলতুবি' : item.status === 'approved' ? 'অনুমোদিত' : 'বাতিল';
                        
                        html += `
                            <div class="history-item">
                                <div class="history-type">
                                    <div class="history-icon withdraw">
                                        <i class="fas fa-wallet"></i>
                                    </div>
                                    <div class="history-info">
                                        <h4>${item.method === 'bkash' ? 'বিকাশ' : item.method === 'nagad' ? 'নগদ' : item.method === 'mobile' ? 'মোবাইল রিচার্জ' : 'USDT'}</h4>
                                        <p>${item.details}</p>
                                        <p>${formatDate(item.requestedAt)}</p>
                                    </div>
                                </div>
                                <div class="history-info">
                                    <div class="history-amount negative">-${formatNumber(item.amount)} HMSTR</div>
                                    <div class="${statusClass}">${statusText}</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    historyContainer.innerHTML = html;
                }
                
            } catch (error) {
                console.error('Error loading withdraw history:', error);
            }
        }

        async function loadReferralHistory() {
            const userId = tg.initDataUnsafe.user.id.toString();
            const historyContainer = document.getElementById('referralHistory');
            
            try {
                const snapshot = await database.ref('referrals/' + userId).limitToLast(10).once('value');
                
                if (!snapshot.exists()) {
                    return;
                }
                
                const historyItems = [];
                snapshot.forEach((childSnapshot) => {
                    const item = childSnapshot.val();
                    item.id = childSnapshot.key;
                    historyItems.unshift(item); // Reverse order (newest first)
                });
                
                // Update UI
                if (historyItems.length > 0) {
                    let html = '';
                    historyItems.forEach(item => {
                        html += `
                            <div class="history-item">
                                <div class="history-type">
                                    <div class="history-icon referral">
                                        <i class="fas fa-user-plus"></i>
                                    </div>
                                    <div class="history-info">
                                        <h4>রেফারেল</h4>
                                        <p>আইডি: ${item.userId}</p>
                                        <p>${formatDate(item.referredAt)}</p>
                                    </div>
                                </div>
                                <div class="history-amount positive">+1.00 HMSTR</div>
                            </div>
                        `;
                    });
                    
                    historyContainer.innerHTML = html;
                }
                
            } catch (error) {
                console.error('Error loading referral history:', error);
            }
        }

        // ========================
        // Event Listeners
        // ========================
        function setupEventListeners() {
            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Show selected section
                    const section = item.dataset.section;
                    Object.values(sections).forEach(sec => sec.classList.add('hidden'));
                    sections[section].classList.remove('hidden');
                });
            });
            
            // Close modals
            closeModalButtons.forEach(button => {
                button.addEventListener('click', () => {
                    Object.values(modals).forEach(modal => modal.classList.remove('active'));
                });
            });
            
            // Notice modal
            document.getElementById('closeNoticeBtn').addEventListener('click', () => {
                modals.notice.classList.remove('active');
            });
            
            // Watch ad button
            document.getElementById('watchAdBtn').addEventListener('click', startAdWatch);
            document.getElementById('startAdBtn').addEventListener('click', startAdWatch);
            
            // Claim ad reward
            document.getElementById('claimAdRewardBtn').addEventListener('click', claimAdReward);
            
            // Verification
            document.getElementById('verifyBtn').addEventListener('click', () => {
                document.getElementById('verificationCode').textContent = verificationCode;
                modals.verification.classList.add('active');
            });
            
            document.getElementById('completeVerificationBtn').addEventListener('click', completeVerification);
            
            // Copy referral links
            document.getElementById('copyLinkBtn').addEventListener('click', () => {
                const link = document.getElementById('referralLink').textContent;
                navigator.clipboard.writeText(link);
                showToast('রেফারেল লিংক কপি হয়েছে!', 'success');
            });
            
            document.getElementById('copyEarnLinkBtn').addEventListener('click', () => {
                const link = document.getElementById('earnReferralLink').textContent;
                navigator.clipboard.writeText(link);
                showToast('রেফারেল লিংক কপি হয়েছে!', 'success');
            });
            
            // Share referral links
            document.getElementById('shareRefBtn').addEventListener('click', () => {
                const link = document.getElementById('referralLink').textContent;
                const message = `AdEarn এ জয়েন করুন এবং বিজ্ঞাপন দেখে আয় করুন! লিংক: ${link}`;
                
                if (tg.isVersionAtLeast('6.2')) {
                    tg.shareUrl(message, link);
                } else {
                    navigator.clipboard.writeText(message);
                    showToast('মেসেজ কপি হয়েছে! টেলিগ্রামে শেয়ার করুন।', 'success');
                }
            });
            
            document.getElementById('shareEarnRefBtn').addEventListener('click', () => {
                const link = document.getElementById('earnReferralLink').textContent;
                const message = `AdEarn এ জয়েন করুন এবং বিজ্ঞাপন দেখে আয় করুন! লিংক: ${link}`;
                
                if (tg.isVersionAtLeast('6.2')) {
                    tg.shareUrl(message, link);
                } else {
                    navigator.clipboard.writeText(message);
                    showToast('মেসেজ কপি হয়েছে! টেলিগ্রামে শেয়ার করুন।', 'success');
                }
            });
            
            // Withdraw
            document.getElementById('submitWithdrawBtn').addEventListener('click', submitWithdrawRequest);
            
            // Contact developer
            document.getElementById('contactDeveloperBtn').addEventListener('click', () => {
                tg.openTelegramLink('https://t.me/AdEarnSupport');
            });
            
            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => {
                tg.close();
            });
        }

        // ========================
        // Initialize App
        // ========================
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize Firebase and user
            await initializeUser();
            
            // Setup event listeners
            setupEventListeners();
            setupWithdrawMethods();
            
            // Show welcome message
            setTimeout(() => {
                showToast('AdEarn এ স্বাগতম!', 'success');
            }, 500);
        });
    </script>
</body>
</html>