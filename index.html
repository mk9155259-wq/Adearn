<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AdEarn - Watch & Earn</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        :root {
            --bg-black: #0a0a0a;
            --card-bg: #161616;
            --neon-green: #39ff14;
            --neon-dim: #2ecb10;
            --text-gray: #a0a0a0;
            --white: #ffffff;
            --danger: #ff4444;
            --nav-bg: rgba(22, 22, 22, 0.95);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-black);
            color: var(--white);
            overflow-x: hidden;
            padding-bottom: 80px;
        }

        .container { padding: 16px; }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 16px;
            border: 1px solid #222;
            transition: var(--transition);
        }

        .neon-text { color: var(--neon-green); text-shadow: 0 0 10px rgba(57, 255, 20, 0.3); }
        .neon-border { border: 1px solid var(--neon-green) !important; }
        
        .btn {
            background: var(--neon-green);
            color: black;
            border: none;
            padding: 14px 24px;
            border-radius: 12px;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 16px;
        }

        .btn:disabled { background: #333; color: #666; cursor: not-allowed; }
        .btn:active { transform: scale(0.98); opacity: 0.9; }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 16px;
            background: var(--bg-black);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .user-pill {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--card-bg);
            padding: 6px 14px 6px 6px;
            border-radius: 30px;
        }

        .user-pill img { width: 32px; height: 32px; border-radius: 50%; border: 1px solid var(--neon-green); }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .stat-card {
            background: var(--card-bg);
            padding: 16px;
            border-radius: 16px;
            text-align: center;
        }

        .stat-value { font-size: 22px; font-weight: 800; margin-top: 4px; }
        .stat-label { font-size: 12px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 0.5px; }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: var(--nav-bg);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid #222;
            z-index: 1000;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-gray);
            font-size: 11px;
            text-decoration: none;
            transition: var(--transition);
        }

        .nav-item.active { color: var(--neon-green); }
        .nav-item svg { width: 24px; height: 24px; margin-bottom: 4px; }

        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ad-timer-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }

        .countdown-circle {
            width: 150px; height: 150px;
            border: 4px solid var(--card-bg);
            border-top: 4px solid var(--neon-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: 800;
            animation: spin 2s linear infinite;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }

        .wheel-container {
            width: 280px;
            height: 280px;
            margin: 20px auto;
            position: relative;
            border: 8px solid var(--card-bg);
            border-radius: 50%;
            overflow: hidden;
            transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1);
        }

        .wheel-pointer {
            position: absolute;
            top: -10px; left: 50%;
            transform: translateX(-50%);
            width: 30px; height: 30px;
            background: var(--neon-green);
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            z-index: 10;
        }

        #toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--neon-green);
            color: black;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 600;
            z-index: 3000;
            display: none;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #222;
        }
    </style>
</head>
<body>

    <div id="toast">Reward Claimed!</div>

    <header>
        <div class="user-pill">
            <img id="user-photo" src="https://via.placeholder.com/100" alt="Avatar">
            <span id="user-name" style="font-weight: 600;">Loading...</span>
        </div>
        <div class="balance-badge" style="background: rgba(57,255,20,0.1); padding: 8px 12px; border-radius: 12px;">
            <span class="neon-text" style="font-weight: 800;">‚ö° <span id="top-balance">0</span></span>
        </div>
    </header>

    <div id="home" class="page active container">
        <div class="card neon-border">
            <p class="stat-label">Total Balance</p>
            <h1 style="font-size: 42px; margin: 5px 0;" class="neon-text">$ <span id="dash-balance">0.00</span></h1>
            <p style="font-size: 13px; color: var(--text-gray);">‚âà <span id="dash-coins">0</span> Coins</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <p class="stat-label">Ads Today</p>
                <p class="stat-value" id="dash-ads">0/20</p>
            </div>
            <div class="stat-card">
                <p class="stat-label">Referrals</p>
                <p class="stat-value" id="dash-ref">0</p>
            </div>
        </div>

        <div class="card" style="margin-top: 16px;">
            <h3 style="margin-bottom: 12px;">Daily Bonus</h3>
            <p style="color: var(--text-gray); font-size: 14px; margin-bottom: 15px;">Claim your 2 free coins every 24 hours.</p>
            <button id="daily-btn" class="btn" onclick="claimDaily()">üéÅ Claim Bonus</button>
        </div>
    </div>

    <div id="ads" class="page container">
        <div class="card">
            <h2 style="margin-bottom: 10px;">GigaPub Ad Engine</h2>
            <p style="color: var(--text-gray); font-size: 14px; margin-bottom: 20px;">Watch a short video ad to earn between 1-3 coins instantly.</p>
            <div style="background: #000; height: 180px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; border: 1px dashed #444;">
                <span style="color: #444;">Ad Placement Holder</span>
            </div>
            <button id="watch-btn" class="btn" onclick="startAd()">üé• Watch Video Ad</button>
        </div>
        <div class="card">
            <h3>Recent Earnings</h3>
            <div id="ad-history">
                <p style="color: #444; text-align: center; padding: 20px;">No ads watched yet</p>
            </div>
        </div>
    </div>

    <div id="spin" class="page container" style="text-align: center;">
        <h2>Lucky Spin</h2>
        <div class="wheel-pointer"></div>
        <div id="wheel" class="wheel-container">
            <img src="https://i.imgur.com/8X8H5vA.png" style="width: 100%; height: 100%;" alt="Wheel">
        </div>
        <button id="spin-btn" class="btn" onclick="spinWheel()" style="margin-top: 20px;">üé° Spin Now (<span id="spin-count">3</span> left)</button>
    </div>

    <div id="withdraw" class="page container">
        <div class="card">
            <p class="stat-label">Available for Withdrawal</p>
            <h2 class="neon-text" style="font-size: 28px;">$ <span id="wd-balance">0.00</span></h2>
        </div>
        <div class="card">
            <div style="margin-bottom: 15px;">
                <label style="display: block; font-size: 12px; margin-bottom: 5px; color: var(--text-gray);">SELECT METHOD</label>
                <select id="wd-method" style="width: 100%; background: #222; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px;">
                    <option value="bkash">bKash</option>
                    <option value="nagad">Nagad</option>
                    <option value="rocket">Rocket</option>
                </select>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; font-size: 12px; margin-bottom: 5px; color: var(--text-gray);">ACCOUNT NUMBER</label>
                <input type="text" id="wd-account" placeholder="Enter number" style="width: 100%; background: #222; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px;">
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-size: 12px; margin-bottom: 5px; color: var(--text-gray);">AMOUNT (MIN 300 COINS)</label>
                <input type="number" id="wd-amount" placeholder="Minimum 300" style="width: 100%; background: #222; border: 1px solid #444; color: white; padding: 12px; border-radius: 8px;">
            </div>
            <button class="btn" onclick="submitWithdraw()">Withdraw Funds</button>
        </div>
    </div>

    <div id="profile" class="page container">
        <div class="card" style="text-align: center;">
            <img id="prof-photo" src="" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--neon-green); margin-bottom: 10px;">
            <h2 id="prof-name">Username</h2>
            <p style="color: var(--text-gray); font-size: 14px;">ID: <span id="prof-id">0000000</span></p>
        </div>
        <div class="card">
            <input type="text" id="ref-link" readonly style="width: 100%; background: #000; border: 1px solid #333; color: var(--neon-green); padding: 10px; border-radius: 8px; margin-bottom: 10px;">
            <button class="btn" onclick="copyRef()">Copy Referral Link</button>
        </div>
    </div>

    <div id="ad-overlay" class="ad-timer-overlay">
        <h2 style="margin-bottom: 20px;">Watching Ad...</h2>
        <div class="countdown-circle"><span id="ad-sec">15</span></div>
    </div>

    <nav class="bottom-nav">
        <a href="#" class="nav-item active" onclick="showPage('home', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg>Home</a>
        <a href="#" class="nav-item" onclick="showPage('ads', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="15" rx="2" ry="2"></rect><path d="M17 2l-5 5-5-5"></path></svg>Ads</a>
        <a href="#" class="nav-item" onclick="showPage('spin', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg>Spin</a>
        <a href="#" class="nav-item" onclick="showPage('withdraw', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>Wallet</a>
        <a href="#" class="nav-item" onclick="showPage('profile', this)"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>Profile</a>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        const firebaseConfig = {
            apiKey: "AIzaSyCppnCPW_npU7QS8tmkX4MGzBtYx35I6G4",
            authDomain: "adearn-79f8b.firebaseapp.com",
            databaseURL: "https://adearn-79f8b-default-rtdb.firebaseio.com",
            projectId: "adearn-79f8b",
            storageBucket: "adearn-79f8b.firebasestorage.app",
            messagingSenderId: "136478270159",
            appId: "1:136478270159:web:24484fc7b56f81ad2f0dba"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let userData = { coins: 0, adsToday: 0, spinsToday: 3, lastBonus: 0, referrals: 0, history: [] };
        let currentUserId = '';

        function init() {
            const user = tg.initDataUnsafe?.user || { id: '696969', first_name: 'Demo User' };
            currentUserId = user.id;
            document.getElementById('user-name').innerText = user.first_name;
            document.getElementById('prof-name').innerText = user.first_name;
            document.getElementById('prof-id').innerText = user.id;
            document.getElementById('ref-link').value = `https://t.me/AdEarnBot?start=${user.id}`;
            
            database.ref('users/' + currentUserId).once('value').then((snapshot) => {
                if (snapshot.exists()) {
                    const data = snapshot.val();
                    userData = {
                        coins: data.coins || 0,
                        adsToday: data.adsToday || 0,
                        spinsToday: data.spinsToday ?? 3,
                        lastBonus: data.lastBonus || 0,
                        referrals: data.referrals || 0,
                        history: data.history || []
                    };
                } else {
                    database.ref('users/' + currentUserId).set(userData);
                }
                updateUI();
            }).catch(() => updateUI());
        }

        function showPage(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
            tg.HapticFeedback.impactOccurred('light');
        }

        function updateUI() {
            document.getElementById('top-balance').innerText = userData.coins || 0;
            document.getElementById('dash-balance').innerText = ((userData.coins || 0) * 0.01).toFixed(2);
            document.getElementById('dash-coins').innerText = userData.coins || 0;
            document.getElementById('wd-balance').innerText = ((userData.coins || 0) * 0.01).toFixed(2);
            document.getElementById('dash-ads').innerText = `${userData.adsToday || 0}/20`;
            document.getElementById('dash-ref').innerText = userData.referrals || 0;
            document.getElementById('spin-count').innerText = userData.spinsToday ?? 3;

            const histDiv = document.getElementById('ad-history');
            if (userData.history && userData.history.length > 0) {
                histDiv.innerHTML = userData.history.map(item => `
                    <div class="history-item">
                        <div><div>${item.type}</div><div style="font-size:10px;color:#666;">${item.date}</div></div>
                        <div class="neon-text">+${item.amount}</div>
                    </div>`).join('');
            }
            if(currentUserId) database.ref('users/' + currentUserId).set(userData);
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 3000);
        }

        function startAd() {
            if (userData.adsToday >= 20) { showToast("Limit reached!"); return; }
            const overlay = document.getElementById('ad-overlay');
            const timerTxt = document.getElementById('ad-sec');
            overlay.style.display = 'flex';
            let timeLeft = 15;
            const interval = setInterval(() => {
                timeLeft--; timerTxt.innerText = timeLeft;
                if (timeLeft <= 0) { clearInterval(interval); overlay.style.display = 'none'; completeAd(); }
            }, 1000);
        }

        function completeAd() {
            const reward = Math.floor(Math.random() * 3) + 1;
            userData.coins += reward; userData.adsToday += 1;
            if(!userData.history) userData.history = [];
            userData.history.unshift({ type: 'Ad Reward', amount: reward, date: new Date().toLocaleTimeString() });
            updateUI(); showToast(`Earned +${reward} Coins!`);
        }

        function claimDaily() {
            const now = Date.now();
            if (now - userData.lastBonus < 86400000) { showToast("Come back later"); return; }
            userData.coins += 5; userData.lastBonus = now;
            if(!userData.history) userData.history = [];
            userData.history.unshift({ type: 'Daily Bonus', amount: 5, date: new Date().toLocaleDateString() });
            updateUI(); showToast("Claimed +5 Coins!");
        }

        let isSpinning = false;
        function spinWheel() {
            if (isSpinning || userData.spinsToday <= 0) { showToast("No spins left!"); return; }
            isSpinning = true; userData.spinsToday -= 1;
            const wheel = document.getElementById('wheel');
            const randomDeg = Math.floor(Math.random() * 360) + 1440;
            wheel.style.transform = `rotate(${randomDeg}deg)`;
            setTimeout(() => { isSpinning = false; userData.coins += 2; updateUI(); showToast("Won 2 Coins!"); }, 4000);
        }

        function submitWithdraw() {
            const amount = document.getElementById('wd-amount').value;
            const account = document.getElementById('wd-account').value;
            const method = document.getElementById('wd-method').value;

            if (amount < 300 || userData.coins < amount) { showToast("Invalid amount"); return; }
            if (!account) { showToast("Enter account number"); return; }

            userData.coins -= amount;
            if(!userData.history) userData.history = [];
            userData.history.unshift({ type: `Withdrawal (${method})`, amount: `-${amount}`, date: new Date().toLocaleDateString() });
            updateUI(); showToast("Pending!");
            tg.HapticFeedback.notificationOccurred('warning');
        }

        function copyRef() {
            const link = document.getElementById('ref-link');
            link.select(); document.execCommand('copy'); showToast("Copied!");
        }

        window.onload = init;
    </script>
</body>
</html>